<div class="d-flex flex-column gap-3 pt-2">
            
    <!-- Tarjeta de Bienvenida -->
    <div class="card border-0 shadow-sm rounded-4 p-4 bg-primary text-white position-relative overflow-hidden">
        <div class="position-absolute end-0 top-0 opacity-25" style="transform: translate(20%, -20%); font-size: 8rem;">üèîÔ∏è</div>
        <div class="position-relative z-index-1">
            <h2 class="h5 fw-bold mb-1">¬°Hola, Aventurero!</h2>
            <p class="small mb-0 text-white-50">Explora y √∫nete a las pr√≥ximas caminatas de La Tribu.</p>
        </div>
    </div>

    <!-- Secci√≥n de Pr√≥ximas Caminatas -->
    <div class="mt-2">
        <div class="d-flex justify-content-between align-items-center mb-3 px-1">
            <h3 class="small fw-bold text-secondary text-uppercase mb-0" style="font-size: 0.75rem; letter-spacing: 0.05em;">Pr√≥ximas Caminatas</h3>
            <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3 py-2 shadow-sm">Abiertas</span>
        </div>
        
        <div id="lista-eventos" class="d-flex flex-column gap-3 pb-4">
            <div class="text-center p-5 text-muted small bg-white rounded-4 shadow-sm border border-light">
                Buscando aventuras disponibles... ‚è≥
            </div>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- MODAL: SOLICITAR PIN DE INSCRIPCI√ìN        -->
<!-- ========================================== -->
<div class="modal fade" id="modalInscripcion" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered px-3">
    <div class="modal-content rounded-4 border-0 shadow-lg">
      <div class="modal-header border-0 pb-0 text-center position-relative">
        <h5 class="modal-title fw-bold text-dark w-100 mt-2">Seguridad Tribu</h5>
        <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center pt-2 pb-4 px-4">
        <div class="mb-3">
            <span class="bg-warning bg-opacity-10 text-warning rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 70px; height: 70px;">
                <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
            </span>
        </div>
        <p class="text-secondary small mb-4">Ingresa tu PIN secreto para confirmar tu inscripci√≥n a <br><strong id="modalEventoNombre" class="text-dark fs-6"></strong>.</p>
        
        <input type="password" id="inputPin" class="form-control form-control-lg text-center fw-bold rounded-4 mb-4 bg-light border-0" placeholder="****" maxlength="4" style="letter-spacing: 0.8em; font-size: 1.5rem;">
        <input type="hidden" id="inputIdEvento">
        
        <button onclick="procesarInscripcion()" class="btn btn-warning w-100 rounded-pill fw-bold p-3 shadow-sm text-dark" id="btnConfirmar">
            Confirmar y Ganar Puntos ‚≠ê
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ========================================== -->
<!-- MODAL: MENSAJE DE √âXITO O ERROR            -->
<!-- ========================================== -->
<div class="modal fade" id="modalMensaje" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered px-4">
        <div class="modal-content rounded-4 border-0 shadow-lg text-center p-4">
            <div id="modalIcono" class="mb-3"></div>
            <h4 id="modalTituloMensaje" class="fw-bold mb-2 text-dark"></h4>
            <p id="modalTextoMensaje" class="text-secondary small mb-4"></p>
            <button type="button" class="btn btn-light border rounded-pill fw-bold w-100 p-3" data-bs-dismiss="modal" id="btnCerrarMensaje">Continuar</button>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- SCRIPT ESPEC√çFICO DE HOME                  -->
<!-- ========================================== -->
<script>
    // 1. Cargar y mostrar los eventos (Igual que antes)
    async function cargarEventos() {
        const contenedor = document.getElementById('lista-eventos');
        const todosLosEventos = await window.CloudDB.obtenerEventos();
        
        const hoy = new Date().toISOString().split('T')[0]; 
        const eventos = todosLosEventos.filter(ev => ev.event_date >= hoy && ev.event_date !== "N/A");
        eventos.sort((a, b) => a.event_date.localeCompare(b.event_date));

        if (!eventos || eventos.length === 0) {
            contenedor.innerHTML = `<div class="text-center p-4 text-muted small bg-white rounded-4 shadow-sm border border-light">No hay aventuras programadas a partir de hoy. üèïÔ∏è</div>`;
            return;
        }

        let html = '';
        eventos.forEach(ev => {
            const precio = ev.price > 0 ? `‚Ç°${ev.price.toLocaleString()}` : 'Gratis';
            html += `
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-4">
                    <h5 class="fw-bold text-dark mb-1">${ev.title}</h5>
                    <div class="d-flex gap-2 mb-3">
                        <span class="badge bg-light text-secondary border">üìÖ ${ev.event_date}</span>
                        <span class="badge bg-light text-secondary border">‚õ∞Ô∏è ${ev.difficulty}</span>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded-3 mb-3 border-start border-4 border-warning">
                        <div>
                            <p class="small text-muted mb-0">Recompensa</p>
                            <p class="fw-bold text-warning mb-0" style="font-size: 1.1rem;">‚≠ê ${ev.points_reward} pts</p>
                        </div>
                        <div class="text-end">
                            <p class="small text-muted mb-0">Costo</p>
                            <p class="fw-bold text-dark mb-0">${precio}</p>
                        </div>
                    </div>

                    <button onclick="abrirModalInscripcion(${ev.id}, '${ev.title}')" class="btn btn-dark w-100 rounded-pill fw-bold p-3 shadow-sm">
                        ¬°Inscribirme a la Aventura!
                    </button>
                </div>
            </div>`;
        });
        contenedor.innerHTML = html;
    }

    // 2. Abrir el Modal Hermoso en lugar del `prompt`
    function abrirModalInscripcion(eventId, eventTitle) {
        document.getElementById('modalEventoNombre').innerText = eventTitle;
        document.getElementById('inputIdEvento').value = eventId;
        document.getElementById('inputPin').value = ''; // Limpiar PIN viejo
        
        const modal = new bootstrap.Modal(document.getElementById('modalInscripcion'));
        modal.show();
    }

    // 3. Procesar la inscripci√≥n al darle "Confirmar"
    async function procesarInscripcion() {
        const pin = document.getElementById('inputPin').value.trim();
        const eventId = document.getElementById('inputIdEvento').value;
        const btn = document.getElementById('btnConfirmar');

        if (!pin) {
            mostrarMensajeAnimado('¬°Atenci√≥n!', 'Debes ingresar tu PIN de seguridad para continuar.', 'warning');
            return;
        }

        // Animaci√≥n de carga en el bot√≥n
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Procesando...';
        btn.disabled = true;

        // Llamamos a la API
        const respuesta = await window.CloudDB.inscribirEvento(pin, eventId);
        
        // Restaurar bot√≥n
        btn.innerHTML = 'Confirmar y Ganar Puntos ‚≠ê';
        btn.disabled = false;

        // Esconder el modal del PIN
        const modalElement = document.getElementById('modalInscripcion');
        const modalInstancia = bootstrap.Modal.getInstance(modalElement);
        if (modalInstancia) modalInstancia.hide();

        // Mostrar resultado
        if (respuesta.status === 'ok') {
            mostrarMensajeAnimado('¬°Aventura Confirmada!', respuesta.message, 'success');
            // Redirigir al ranking al cerrar el modal de √©xito
            document.getElementById('btnCerrarMensaje').onclick = () => window.location.hash = '#usuarios';
        } else {
            mostrarMensajeAnimado('Error de Inscripci√≥n', respuesta.message || respuesta.error, 'error');
            document.getElementById('btnCerrarMensaje').onclick = null; // No redirigir si falla
        }
    }

    // 4. Controlador Universal de Mensajes (reemplaza a `alert`)
    function mostrarMensajeAnimado(titulo, texto, tipo) {
        const iconos = {
            success: '<div class="mx-auto bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; font-size: 2.5rem;">üéâ</div>',
            error: '<div class="mx-auto bg-danger bg-opacity-10 text-danger rounded-circle d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; font-size: 2.5rem;">‚ùå</div>',
            warning: '<div class="mx-auto bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; font-size: 2.5rem;">‚ö†Ô∏è</div>'
        };

        document.getElementById('modalIcono').innerHTML = iconos[tipo] || iconos.success;
        document.getElementById('modalTituloMensaje').innerText = titulo;
        document.getElementById('modalTextoMensaje').innerText = texto;

        const modal = new bootstrap.Modal(document.getElementById('modalMensaje'));
        modal.show();
    }

    // Ejecutar apenas carga la pantalla
    setTimeout(cargarEventos, 100);
</script>
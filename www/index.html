<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffc107">
    <title>La Tribu</title>

    <link href="css/bootstrap.css" rel="stylesheet">
    
    <style>
        .pt-safe { padding-top: env(safe-area-inset-top); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .btn-nav:hover, .btn-nav:active { background-color: rgba(0,0,0,0.05); }
        /* Transición suave opcional para cuando cambia la vista */
        #app-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="vh-100 d-flex flex-column overflow-hidden bg-light">

    <!-- Header Fijo (Agregamos el ID app-header) -->
    <header id="app-header" class="bg-warning text-dark shadow-sm pt-safe">
        <div class="d-flex align-items-center justify-content-between px-3 py-3">
            <h1 class="h5 mb-0 fw-bold">La Tribu de Los Libres</h1>
        </div>
    </header>

    <!-- ESTE ES EL HUECO DONDE SE CARGARÁN LAS DEMÁS VISTAS -->
    <main id="app-content" class="flex-grow-1 overflow-auto p-3">
        <!-- Aquí aparecerá mágicamente home.html, perfil.html, etc. -->
    </main>

    <!-- Menú Inferior Fijo -->
    <nav id="app-nav" class="bg-white border-top pb-safe shadow-sm w-100 mt-auto">
        <div class="d-flex w-100" style="height: 64px;">
            <a href="#home" class="btn btn-nav text-warning border-0 d-flex flex-column align-items-center justify-content-center flex-fill h-100 rounded-0 text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="mb-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                <span class="fw-medium" style="font-size: 10px;">Inicio</span>
            </a>
            <a href="#usuarios" class="btn btn-nav text-secondary border-0 d-flex flex-column align-items-center justify-content-center flex-fill h-100 rounded-0 text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="mb-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <span class="fw-medium" style="font-size: 10px;">Usuarios</span>
            </a>
            <a href="#perfil" class="btn btn-nav text-secondary border-0 d-flex flex-column align-items-center justify-content-center flex-fill h-100 rounded-0 text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="mb-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                <span class="fw-medium" style="font-size: 10px;">Perfil</span>
            </a>
        </div>
    </nav>

    <script src="js/bootstrap.js"></script>
    
    <!-- LÍNEA CORREGIDA: api_db.js debe cargar justo antes de nuestro script mágico -->
    <script src="js/api_db.js"></script>

    <!-- EL SCRIPT MÁGICO QUE HACE LA HERENCIA -->
    <script>
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
            } else {
                input.type = 'password';
            }
        }

        async function cargarVista() {
            let vista = window.location.hash.substring(1) || 'home';
            const contenedor = document.getElementById('app-content');
            const header = document.getElementById('app-header');
            const nav = document.getElementById('app-nav');

            if (vista === 'login' || vista === 'registro') {
                header.classList.add('d-none');
                nav.classList.remove('d-flex');
                nav.classList.add('d-none');
            } else {
                header.classList.remove('d-none');
                nav.classList.remove('d-none');
                nav.classList.add('d-flex');
            }

            try {
                contenedor.style.animation = 'none';
                contenedor.offsetHeight; 
                contenedor.style.animation = null;

                const respuesta = await fetch(vista + '.html');
                if (!respuesta.ok) throw new Error('No se encontró el archivo');
                
                const html = await respuesta.text();
                contenedor.innerHTML = html;

                // ==============================================================
                // ¡LA MAGIA REAL PARA EJECUTAR LOS SCRIPTS!
                // Al inyectar HTML, el navegador no lee las etiquetas <script>.
                // Aquí las extraemos y las forzamos a ejecutarse.
                // ==============================================================
                const scripts = contenedor.querySelectorAll('script');
                scripts.forEach(script => {
                    const nuevoScript = document.createElement('script');
                    nuevoScript.text = script.innerHTML;
                    document.body.appendChild(nuevoScript).parentNode.removeChild(nuevoScript);
                });

            } catch (error) {
                contenedor.innerHTML = `<h3 class="text-danger mt-4 text-center">Error: ${error.message}</h3>`;
            }
        }

        window.addEventListener('hashchange', cargarVista);
        window.addEventListener('DOMContentLoaded', cargarVista);
    </script>
</body>
</html>